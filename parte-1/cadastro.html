<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="shortcut icon" href="imagens/logo.png" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <title>Cadastro — Casa das Patinhas</title>
  <meta name="description" content="Formulário de cadastro para adoção, voluntariado e doações.">
</head>

<body>
  <header>
    <div class="header-content">
      <h1>Formulário de Cadastro</h1>

      <nav aria-label="Navegação principal">
        <ul>
          <li><a href="index.html">Início</a></li>
          <li><a href="projetos.html">Projetos</a></li>
          <li><a href="cadastro.html" class="active">Cadastro</a></li>
        </ul>
      </nav>

      <button class="nav-toggle" aria-label="Abrir menu" aria-expanded="false">
        <span class="nav-toggle-icon"></span>
      </button>
    </div>
  </header>

  <main>
    <figure>
      <img src="imagens/adocao-ONG.jpg" alt="cães filhotes para adoção" style="border-radius: 8px;">
      <figcaption>Faça parte da mudança: cadastre-se e ajude um animal a encontrar um lar.</figcaption>
    </figure>

    <form id="cadastroForm" novalidate>
      <fieldset>
        <legend>Dados pessoais</legend>
        <div class="row">
          <div>
            <label for="nome">Nome completo *</label>
            <input id="nome" name="nome" type="text" required minlength="3" placeholder="Seu nome completo">
          </div>

          <div>
            <label for="email">E‑mail *</label>
            <input id="email" name="email" type="email" required placeholder="seu@exemplo.com">
          </div>

          <div>
            <label for="cpf">CPF *</label>
            <input id="cpf" name="cpf" type="text" inputmode="numeric" required maxlength="14" placeholder="000.000.000-00" aria-describedby="cpfHelp">
            <p id="cpfHelp" class="small">Formato: 000.000.000-00</p>
          </div>

          <div>
            <label for="telefone">Telefone *</label>
            <input id="telefone" name="telefone" type="tel" inputmode="tel" required maxlength="15" placeholder="(00) 91234-5678">
          </div>

          <div>
            <label for="nascimento">Data de nascimento *</label>
            <input id="nascimento" name="nascimento" type="date" required>
          </div>

          <div>
            <label for="tipoCadastro">Motivo do cadastro *</label>
            <select id="tipoCadastro" name="tipoCadastro" required>
              <option value="">— selecione —</option>
              <option value="adocao">Adoção</option>
              <option value="voluntariado">Voluntariado</option>
              <option value="doacao">Doação</option>
            </select>
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Endereço</legend>
        <div class="row">
          <div class="full">
            <label for="endereco">Endereço *</label>
            <input id="endereco" name="endereco" type="text" required placeholder="Rua, número, complemento">
          </div>

          <div>
            <label for="cep">CEP *</label>
            <input id="cep" name="cep" type="text" inputmode="numeric" required maxlength="9" placeholder="00000-000">
          </div>

          <div>
            <label for="cidade">Cidade *</label>
            <input id="cidade" name="cidade" type="text" required>
          </div>

          <div>
            <label for="estado">Estado *</label>
            <input id="estado" name="estado" type="text" required maxlength="2" placeholder="CE">
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Informações adicionais</legend>
        <label for="observacoes">Observações (alergias, experiência com animais, disponibilidade)</label>
        <textarea id="observacoes" name="observacoes" rows="4"></textarea>
      </fieldset>

      <div class="actions">
        <button type="reset" form="cadastroForm">Limpar</button>
        <button type="submit">Enviar cadastro</button>
      </div>

      <p id="formMessage" class="small" role="status" aria-live="polite"></p>
    </form>
  </main>

  <footer>
    <div class="footer-content">
      <p class="small">Ao enviar, você concorda com o uso dos dados para contato em processos de adoção, voluntariado e doação.</p>
    </div>
  </footer>

  <script>
    function aplicarMascara(input, mascaraFn) {
      input.addEventListener('input', function (e) {
        const pos = input.selectionStart;
        const oldLen = input.value.length;
        input.value = mascaraFn(input.value);
        const newLen = input.value.length;
        input.selectionEnd = pos + (newLen - oldLen);
      });
    }

    function mascaraCPF(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      return v.slice(0, 14);
    }

    function mascaraTelefone(v) {
      v = v.replace(/\D/g, '');
      if (v.length <= 2) return v;
      v = v.replace(/^(\d{2})(\d)/, '($1) $2');
      if (v.length <= 7) return v;
      v = v.replace(/(\d{5})(\d{4})$/, '$1-$2');
      return v.slice(0, 15);
    }

    function mascaraCEP(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/(\d{5})(\d)/, '$1-$2');
      return v.slice(0, 9);
    }

    function validarCPF(cpf) {
      cpf = cpf.replace(/\D/g, '');
      if (cpf.length !== 11) return false;
      if (/^(\d)\1{10}$/.test(cpf)) return false;
      function calc(digs) {
        let soma = 0; for (let i = 0; i < digs; i++) soma += +cpf[i] * (digs + 1 - i);
        let res = (soma * 10) % 11; return res === 10 ? 0 : res;
      }
      return calc(9) === +cpf[9] && calc(10) === +cpf[10];
    }

    const cpfInput = document.getElementById('cpf');
    const telInput = document.getElementById('telefone');
    const cepInput = document.getElementById('cep');
    aplicarMascara(cpfInput, mascaraCPF);
    aplicarMascara(telInput, mascaraTelefone);
    aplicarMascara(cepInput, mascaraCEP);

    const form = document.getElementById('cadastroForm');
    const msg = document.getElementById('formMessage');

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      if (!form.checkValidity()) {
        form.reportValidity();
        msg.textContent = 'Por favor, corrija os campos obrigatórios.';
        msg.className = 'error';
        return;
      }

      if (!validarCPF(cpfInput.value)) {
        msg.textContent = 'CPF inválido.';
        msg.className = 'error';
        cpfInput.focus();
        return;
      }

      const nascimento = document.getElementById('nascimento').value;
      if (nascimento) {
        const hoje = new Date();
        const nasc = new Date(nascimento + 'T00:00:00');
        const idade = hoje.getFullYear() - nasc.getFullYear() - ((hoje.getMonth() < nasc.getMonth() || (hoje.getMonth() === nasc.getMonth() && hoje.getDate() < nasc.getDate())) ? 1 : 0);
        if (idade < 18) {
          msg.textContent = 'É necessário ter 18 anos ou mais para se cadastrar.';
          msg.className = 'error';
          return;
        }
      }

      msg.textContent = 'Cadastro enviado com sucesso! Entraremos em contato em breve.';
      msg.className = ''; // A classe 'success' será aplicada pelo CSS
      form.reset();
    });

    [cpfInput, telInput, cepInput, document.getElementById('email')].forEach(el => el.addEventListener('input', () => { msg.textContent = ''; msg.className = 'small'; }));
  </script>

  <script>
    const navToggle = document.querySelector('.nav-toggle');
    const mainNav = document.querySelector('header nav');

    if (navToggle && mainNav) {
      navToggle.addEventListener('click', () => {
        const isExpanded = navToggle.getAttribute('aria-expanded') === 'true';
        document.body.classList.toggle('nav-open');
        navToggle.setAttribute('aria-expanded', !isExpanded);
        navToggle.setAttribute('aria-label', isExpanded ? 'Abrir menu' : 'Fechar menu');
      });
    }
  </script>
</body>
</html>
